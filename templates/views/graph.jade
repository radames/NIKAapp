extends ../layouts/default
block visHeader
	script(src="//cdnjs.cloudflare.com/ajax/libs/vis/4.17.0/vis.min.js")
	link(href="//cdnjs.cloudflare.com/ajax/libs/vis/4.17.0/vis.min.css", rel="stylesheet")
	link(href="/styles/graph.css", rel="stylesheet")

			
block content
	.row
		.col-md-10.col-md-offset-1
			.selectList
				if workingGroups
					.dropdown
							button(class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true") Working Group 
								b.caret
							ul.dropdown-menu
								li: a(href='/task-map/') Alle
								each wGroup, wGroup_i in workingGroups
									li: a(href='/task-map/' + wGroup.key)
										= wGroup.name
			.subtitle
				if workingGroup
					h4= workingGroup.name
				else
					h4 Alle	
			#visualization
			#legend
				if workingGroups
					each wGroup, wGroup_i in workingGroups
						div
							a(href='/task-map/' + wGroup.key)
								icon(class="glyphicon glyphicon-stop", id=wGroup.key)
								= wGroup.name
		if !tasks
			.jumbotron.text-center
				h2 Invalid post...
				p.lead Please check the url and try again
		else
			if tasks.data.length
				each task, i in tasks.data
						div(id=task._id).hovermsg
							.panel.panel-info
								.panel-heading
									!= task.title
								.panel-body
									div
										!= task.description.html
									div
										b Working Group 
										each wGroup, wGroup_i in task.workingGroup
											a(href='/task-map/' + wGroup.key)= wGroup.name
											if wGroup_i < task.workingGroup.length - 1
												| , 
											else
												| 
							
						.col-md-8.col-md-offset-2
							hr
							article
								header
										h1= task.title
										a(href='/admin/tasks/' + task._id)
											icon(class="glyphicon glyphicon-edit")
								div
									p.text-muted.text-small
										if task.startOn
											|Start on 
											time(datetime=task.startOn)=task._.startOn.format('Do MMMM YYYY')
										|  - 
										if task.endOn
											|End on 
											time(datetime=task.endOn)=task._.endOn.format('Do MMMM YYYY')
										if task.workingGroup && task.workingGroup.length
											p
											b Working Group 
											each wGroup, wGroup_i in task.workingGroup
												a(href='/task-map/' + wGroup.key)= wGroup.name
												if wGroup_i < task.workingGroup.length - 1
													| , 
												else
													| 
										if task.assignedTo && task.assignedTo.length
											p
											b Assigned to: 				
											each aTo, aTo_i in task.assignedTo
												a(href='/blog/' + aTo.key)= aTo.name.full
												if aTo_i < task.assignedTo.length - 1
													| , 
												else
													| 
										if task.createdBy
											p
											b Created by: #{task.createdBy.name.full}
								hr
								!= task.description.html
		


block js
	script.
		var nodes = !{JSON.stringify(graphData.nodes)};
		var relations = !{JSON.stringify(graphData.relations)};
	script(src='/js/graph.js')
